<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon"
        href="https://1.bp.blogspot.com/-XScuPk-wlv8/YOFujE4PP7I/AAAAAAAAEEo/IOY7NfVSpeoe8kXyqcTgbv62Fp1KjYpAACLcBGAsYHQ/s16000/Currency-Converter.jpg"
        type="image/jpg">
  <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h1><b>Currency Converter</b></h1>
        <form>
            <div class="amount">
                <p>Enter Amount </p>
                <input type="text" name="text" id="text"><i id="eye" class="fa-regular fa-eye-slash"></i>
            </div>
            <div class="dropdown">
                <div class="from">
                    <p>From</p>
                    <div class="select-container">
                        <img src="https://flagsapi.com/US/flat/64.png" alt="">
                        <select name="from">
                        </select>
                    </div>
                </div>
                <i class="fa-solid fa-arrow-right-arrow-left"></i>
                <div class="To">
                    <p>To</p>
                    <div class="select-container">
                        <img src="https://flagsapi.com/IN/flat/64.png" alt="">
                        <select name="to">
                        </select>
                    </div>
                </div>
            </div>

            <div class="msg"><b></b></div>
            <button id="getEx">Get Exchange Rate</button>
        </form>
    </div>
    <script src="codes.js"></script>


    <script>
        let Base_Url = " https://cdn.jsdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies";

        let dropdown = document.querySelectorAll(".dropdown select");
        let btn = document.querySelector('form button');

        for (let select of dropdown) {
            for (Currcode in countryList) {
                let newopt = document.createElement("option");
                newopt.innerText = Currcode;
                newopt.value = Currcode;
                if (select.name === "from" && Currcode === "USD") {
                    newopt.selected = "selected";
                }
                else if (select.name === "to" && Currcode === "INR") {
                    newopt.selected = "selected";
                }
                select.append(newopt);

            }
            select.addEventListener("change", (evt) => {
                updateFlag(evt.target);
            })
        }


        const updateFlag = (element) => {
            let Currcode = element.value;
            let CountryCode = countryList[Currcode];

            let newSrc = `https://flagsapi.com/${CountryCode}/flat/64.png`;
            let img = element.parentElement.querySelector('img');
            img.src = newSrc;
        }

        const CuConvert = async () => {
            let amount = document.querySelector(".amount input");
            let Amtval = amount.value;
            if (Amtval === "" || Amtval < 1) {
                Amtval = 1;
                amount.value = 1;
            }

            let from = document.querySelector(".from select");
            let to = document.querySelector(".To select");

            const url = `${Base_Url}/${from.value.toLowerCase()}/${to.value.toLowerCase()}.json`;

            const respons = await fetch(url);
            // console.log(respons);
            let data = await respons.json();
            // console.log(data);
            let rate = data[to.value.toLowerCase()];
            // console.log(rate);

            let finalval = Amtval * rate;
            console.log(finalval);
            let msg = document.querySelector(".msg");
            msg.innerHTML = `<b>${amount.value} ${from.value} =  ${finalval} ${to.value}</b>`;


        }


        btn.addEventListener("click", (evt) => {
            evt.preventDefault();
            CuConvert();
        })



    </script>
</body>

</html>
